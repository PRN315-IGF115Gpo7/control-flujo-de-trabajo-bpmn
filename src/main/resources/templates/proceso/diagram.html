<!DOCTYPE html>
<html layout:decorate="~{layouts/layout}">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>

  <!-- necessary stylesheets -->

  <link rel="stylesheet" th:href="@{/bpmn/css/diagram-js.css}">
  <link rel="stylesheet" th:href="@{/bpmn/css/bpmn.css}">

  <script th:src="@{/bpmn/js/bpmn-viewer.development.js}"></script>
  <script th:src="@{/bpmn/js/bpmn-modeler.development.js}"></script>

  <!--<script src="https://unpkg.com/bpmn-js@7.3.1/dist/bpmn-viewer.development.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/bpmn-js@7.3.1/dist/assets/diagram-js.css" />
  <link rel="stylesheet" href="https://unpkg.com/bpmn-js@7.3.1/dist/assets/bpmn-font/css/bpmn.css" />

  <script src="https://unpkg.com/bpmn-js@7.3.1/dist/bpmn-modeler.development.js"></script>

  <script src="https://unpkg.com/jquery@3.3.1/dist/jquery.js"></script>-->
</head>

<body>
  <h1 class="m-0 text-dark" layout:fragment="titulo_seccion">Control de Flujos de Trabajo</h1>

	<ol class="breadcrumb float-sm-right" layout:fragment="breadcrumb">
        <li class="breadcrumb-item"><a href="#">Home</a></li>
        <li class="breadcrumb-item active">Dise√±ar proceso</li>
    </ol>

	<div layout:fragment="content" style="height: 100vh;">

      <div id="canvas" style="height: 100%"></div>
	</div>


	<section layout:fragment="scripts">
    <script>

        $('body').prop("class", "sidebar-mini layout-fixed sidebar-collapse")

        //var diagramUrl = 'https://cdn.staticaly.com/gh/bpmn-io/bpmn-js-examples/dfceecba/starter/diagram.bpmn';
        var diagramUrl = 'http://127.0.0.1:8080/bpmn/base.bpmn';

        // modeler instance
        var bpmnModeler = new BpmnJS({
          container: '#canvas',
          keyboard: {
            bindTo: window
          }
        });

        //Save diagram contents and print them to the console.
        async function exportDiagram() {

          try {

            var result = await bpmnModeler.saveXML({ format: true });

            alert('Diagram exported. Check the developer tools!');

            console.log('DIAGRAM', result.xml);
          } catch (err) {

            console.error('could not save BPMN 2.0 diagram', err);
          }
        }

        /**
         * Open diagram in our modeler instance.
         *
         * @param {String} bpmnXML diagram to display
         */
        async function openDiagram(bpmnXML) {

          // import diagram
          try {

            await bpmnModeler.importXML(bpmnXML);

            // access modeler components
            var canvas = bpmnModeler.get('canvas');
            //var overlays = bpmnModeler.get('overlays');


            // zoom to fit full viewport
            canvas.zoom('fit-viewport');

            // attach an overlay to a node
            /*overlays.add('SCAN_OK', 'note', {
              position: {
                bottom: 0,
                right: 0
              },
              html: '<div class="diagram-note">Mixed up the labels?</div>'
            });*/

            // add marker
            canvas.addMarker('SCAN_OK', 'needs-discussion');
          } catch (err) {

            console.error('could not import BPMN 2.0 diagram', err);
          }
        }

        // load external diagram file via AJAX and open it
        $.get(diagramUrl, openDiagram, 'text');

        // wire save button
        $('#save-button').click(exportDiagram);


        //Events
        var eventBus = bpmnModeler.get('eventBus');

        // you may hook into any of the following events
        var events = [
          //'element.hover',
          //'element.out',
          //'element.click',
          'element.dblclick'
          //'element.mousedown',
          //'element.mouseup'
        ];

        events.forEach(function(event) {

          eventBus.on(event, function(e) {
            // e.element = the model element
            // e.gfx = the graphical element

            console.log(event + ' on: ' + e.element.id + ' text: ' + e.element.businessObject.name);
          });
        });

    </script>
    <svg id="helper-svg" width="0" height="0" style="visibility: hidden; position: fixed"></svg>

	</section>
</body>

</html>
